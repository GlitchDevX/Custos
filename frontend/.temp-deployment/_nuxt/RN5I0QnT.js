import{i as me,an as de,cl as fe,x as _,h as pe,K as U,M as xe,N as be,q as O,o as k,w as p,b as v,d as G,a as y,c as W,p as t,G as J,H as T,E as he,n as q,t as L,j as H,T as ke,U as ge,a7 as ye}from"./C5MHcV20.js";import{b as Ee,g as Ce,m as we,y as z,o as r,n as P,T as De,aA as Ie,E as _e,i as $e}from"./B-w2PmyG.js";import{d as je}from"./DxoyWOnx.js";import{C as Oe}from"./BZQTiNcE.js";import{m as Me,g as Ne}from"./Dvs1YDLf.js";import{_ as Se,p as Q}from"./CcPz-bu3.js";import{u as Ve}from"./bbYeuRSJ.js";import{x as Fe}from"./BiT_m2g7.js";import{b as We}from"./CrZCX3n8.js";import{M as ze,J as Re}from"./DYiXfOg6.js";import"./CtBxx05M.js";import"./B45bc6ym.js";import"./CV4Hssdo.js";import"./Dni0qEc-.js";import"./DRFfvYGx.js";import"./CCe8tkwL.js";import"./DpW4S5al.js";function Ae(R,g){return{handleDragEnd:(m,c)=>{if(!m||!c)return;const{id:$,parentId:u}=m,{id:V,parentId:M,offset:F}=c;if(u!==M)return;const i=R.value.find(d=>d.uid===u);if(!i||!i["x-scalar-environments"])return;const x=i["x-scalar-environments"],f=Object.keys(x);({...x});const E=f.findIndex(d=>d===$);f.splice(E,1);const C=f.findIndex(d=>d===V)+(F===1?1:0);f.splice(C,0,$);const w=f.reduce((d,o)=>{const j=x[o];return j&&(d[o]=j),d},{});i["x-scalar-environments"]=w,g.edit(i.uid,"x-scalar-environments",i["x-scalar-environments"])},isDroppable:(m,c)=>m.parentId===c.parentId}}const Be={class:"flex-1"},Ke=["onClick"],Ue={class:"flex h-5 max-w-[14px] items-center justify-center"},rn=me({__name:"Environment",setup(R){const g=de(),m=fe(),{activeWorkspace:c,activeEnvironment:$,activeWorkspaceCollections:u,activeEnvVariables:V}=Ee(),{events:M,workspaceMutators:F,collectionMutators:i}=Ce(),{collapsedSidebarFolders:x,toggleSidebarFolder:f}=we(),E=z(),C=z(),w=z(),d=_(null),o=_("default"),j=_(""),D=_(void 0),b=_(void 0),N=_(void 0),{toast:A}=$e(),X=e=>JSON.parse(e);function B(e,a,n){e&&(a.uid===n?A(`Environment name already used in ${a.info?.title}`,"error"):A("Environment name already used in another collection","error"))}const I=pe(()=>u.value.filter(e=>e.info?.title!=="Drafts"));function Y(e){I.value.some(a=>{const n=Object.keys(a["x-scalar-environments"]||{}).includes(e.name);return B(n,a,e.collectionId),n})||(e.collectionId&&(i.addEnvironment(e.name,{variables:{},color:e.color},e.collectionId),x[e.collectionId]||f(e.collectionId),g.push({name:"environment.collection",params:{[r.Collection]:e.collectionId,[r.Environment]:e.name}})),C.hide())}function Z(e){if(!$)return;const a=X(e);if(o.value==="default")F.edit(c.value?.uid,"environments",a);else{const n=u.value.find(l=>l["x-scalar-environments"]?.[o.value??""]);if(n?.["x-scalar-environments"]?.[o.value??""]){const l=n["x-scalar-environments"][o.value??""];l&&(l.variables=a,i.edit(n.uid,"x-scalar-environments",n["x-scalar-environments"]))}}}const S=e=>{D.value=e,C.show()},ee=(e,a)=>{b.value=e,D.value=a,N.value=e,w.show()},ne=e=>{d.value=e,j.value=u.value.find(a=>a["x-scalar-environments"]?.[e])?.["x-scalar-environments"]?.[e]?.color??"",E.show()},ae=e=>{const a=d.value;typeof a=="string"&&(u.value.some(n=>n["x-scalar-environments"]?.[a])&&u.value.forEach(n=>{n["x-scalar-environments"]?.[a]&&(n["x-scalar-environments"][a].color=e,i.edit(n.uid,"x-scalar-environments",n["x-scalar-environments"]))}),E.hide())};function oe(e){I.value.forEach(n=>{i.removeEnvironment(e,n.uid)});const a=I.value.flatMap(n=>Object.keys(n["x-scalar-environments"]||{}));if(a.length>0){const n=a[a.length-1];if(!n)return;const l=u.value.find(s=>Object.keys(s["x-scalar-environments"]||{}).includes(n));o.value=n,g.push({name:"environment.collection",params:{[r.Collection]:l?.uid,[r.Environment]:n}}),l&&!x[l.uid]&&f(l.uid)}else o.value="default",g.push({name:"environment.default",params:{[r.Workspace]:c.value?.uid}})}const te=()=>o.value==="default"?"Global Environment":o.value,le=()=>o.value==="default"?JSON.stringify(c.value?.environments,null,2):JSON.stringify(u.value.find(e=>e["x-scalar-environments"]?.[o.value??""])?.["x-scalar-environments"]?.[o.value??""]?.variables,null,2),re=e=>x[e],K=e=>{e?.createNew&&m.name==="environment"&&S()};U(()=>[m.params[r.Collection],m.params[r.Environment]],([e,a])=>{e?o.value=a:o.value="default"}),xe(()=>{o.value=m.params[r.Environment]||"default",M.hotKeys.on(K);const e=m.params[r.Collection];e&&!x[e]&&f(e)}),be(()=>M.hotKeys.off(K));const se=(e,a,n)=>{const l=n?{name:"environment.collection",params:{[r.Workspace]:c.value?.uid,[r.Collection]:n,[r.Environment]:a}}:{name:"environment.default",params:{[r.Workspace]:c.value?.uid,[r.Environment]:a}};e.metaKey?window.open(g.resolve(l).href,"_blank"):g.push(l)};function ie(){b.value=void 0,D.value=void 0,N.value=void 0,w.hide()}function ce(e){I.value.some(a=>{const n=Object.keys(a["x-scalar-environments"]||{}).includes(e);return B(n,a,D.value),n})||(e&&b.value!=="default"&&u.value.forEach(a=>{if(a["x-scalar-environments"]?.[b.value??""]){const n=a["x-scalar-environments"],l={};Object.keys(n).forEach(s=>{const h=n[s];h&&(s===b.value?l[e]=h:l[s]=h)}),a["x-scalar-environments"]=l,i.edit(a.uid,"x-scalar-environments",a["x-scalar-environments"])}}),e&&o.value===b.value&&(o.value=e),b.value=void 0,D.value=void 0,N.value=void 0,w.hide())}const{handleDragEnd:ue,isDroppable:ve}=Ae(u,i);return U(()=>m.query.openEnvironmentModal,e=>{e==="true"&&S()},{immediate:!0}),(e,a)=>(k(),O(Ve,null,{default:p(()=>[v(Me,{title:"Collections"},{content:p(()=>[y("div",Be,[v(Se,null,{default:p(()=>[(k(),O(Q,{key:"default",class:"text-xs",isCopyable:!1,to:{name:"environment",params:{[t(r).Environment]:"default"}},type:"environment",variable:{name:"Global Environment",uid:"default",icon:"Globe",isDefault:!0}},null,8,["to"])),(k(!0),W(J,null,T(I.value,n=>(k(),W("li",{key:n.uid,class:"gap-1/2 flex flex-col"},[y("button",{class:"hover:bg-b-2 group flex w-full items-center gap-1.5 rounded p-1.5 text-left text-sm font-medium break-words",type:"button",onClick:l=>t(f)(n.uid)},[y("span",Ue,[v(t(je),{class:"text-sidebar-c-2 size-3.5 min-w-3.5 stroke-2 group-hover:hidden",src:n["x-scalar-icon"]||"interface-content-folder"},null,8,["src"]),y("div",{class:q({"rotate-90":t(x)[n.uid]})},[v(t(P),{class:"text-c-3 hover:text-c-1 hidden text-sm group-hover:block",icon:"ChevronRight",size:"md"})],2)]),G(" "+L(n.info?.title??""),1)],8,Ke),he(y("div",{class:q({"before:bg-border relative mb-[.5px] before:pointer-events-none before:absolute before:top-0 before:left-3 before:z-1 before:h-[calc(100%_+_.5px)] before:w-[.5px] last:mb-0 last:before:h-full":Object.keys(n["x-scalar-environments"]||{}).length>0})},[(k(!0),W(J,null,T(n["x-scalar-environments"],(l,s)=>(k(),O(Q,{key:s,class:"text-xs",collectionId:n.uid,isCopyable:!1,isDeletable:!0,isRenameable:!0,isDraggable:!0,isDroppable:t(ve),to:{name:"environment.collection",params:{[t(r).Collection]:n.uid,[t(r).Environment]:s}},type:"environment",variable:{name:s,uid:s,color:l.color??"#FFFFFF",isDefault:!1},warningMessage:"Are you sure you want to delete this environment?",onClick:ke(h=>se(h,s,n.uid),["prevent"]),onColorModal:h=>ne(s),onDelete:h=>oe(s),onRename:h=>ee(s,n.uid),onOnDragEnd:t(ue)},null,8,["collectionId","isDroppable","to","variable","onClick","onColorModal","onDelete","onRename","onOnDragEnd"]))),128)),Object.keys(n["x-scalar-environments"]||{}).length===0?(k(),O(t(De),{key:0,class:"text-c-1 hover:bg-b-2 flex h-8 w-full justify-start gap-1.5 py-0 pl-6 text-xs",variant:"ghost",onClick:l=>S(n.uid)},{default:p(()=>[v(t(P),{icon:"Add",size:"sm"}),a[2]||(a[2]=y("span",null,"Add Environment",-1))]),_:2,__:[2]},1032,["onClick"])):H("",!0)],2),[[ge,re(n.uid)]])]))),128))]),_:1})])]),button:p(()=>[v(Ne,{click:S,hotkey:"N"},{title:p(()=>a[3]||(a[3]=[G(" Add Environment ")])),_:1})]),_:1}),v(Fe,{class:"flex-1"},{default:p(()=>[v(We,null,ye({default:p(()=>[o.value&&t(c)?(k(),O(Ie,{key:0,class:"py-2 pr-2 pl-px md:px-4",envVariables:t(V),environment:t($),language:"json",lineNumbers:"",lint:"",modelValue:le(),workspace:t(c),"onUpdate:modelValue":Z},null,8,["envVariables","environment","modelValue","workspace"])):H("",!0)]),_:2},[o.value?{name:"title",fn:p(()=>[y("span",null,L(te()),1)]),key:"0"}:void 0]),1024)]),_:1}),v(ze,{selectedColor:j.value,state:t(E),onCancel:a[0]||(a[0]=n=>t(E).hide()),onSubmit:ae},null,8,["selectedColor","state"]),v(Re,{activeWorkspaceCollections:I.value,collectionId:D.value,state:t(C),onCancel:a[1]||(a[1]=n=>t(C).hide()),onSubmit:Y},null,8,["activeWorkspaceCollections","collectionId","state"]),v(t(_e),{size:"xxs",state:t(w),title:`Edit ${b.value}`},{default:p(()=>[v(Oe,{name:N.value??"",onClose:ie,onEdit:ce},null,8,["name"])]),_:1},8,["state","title"])]),_:1}))}});export{rn as default};
