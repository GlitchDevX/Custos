import{aU as Q,x as L,i as te,ay as ue,bP as oe,az as de,aA as J,h as R,ax as ce,bQ as fe,q as F,o as w,w as P,b as B,p as m,aC as ae,S as j,T as D,s as ne,bR as ve,bS as pe,J as he,aF as U,aQ as me,m as re,bT as Y,Q as ge,aI as ye,b2 as be,K as O,bK as xe,c as $,a as M,G as X,H as ke,n as q,v as Ce,aL as Z,j as ee,aM as le,t as Te}from"./C5MHcV20.js";import{R as Ke}from"./DknASjG-.js";import Ie from"./CMHHZAPh.js";function W(s,b,e){const v=s.findIndex(h=>Q(h,b)),A=s.findIndex(h=>Q(h,e));if(v===-1||A===-1)return[];const[l,K]=[v,A].sort((h,r)=>h-r);return s.slice(l,K+1)}function Se(s,b){const e=L(),v=(l,K)=>{if(b.multiple&&Array.isArray(s.value))if(b.selectionBehavior==="replace")s.value=[l],e.value=l;else{const h=s.value.findIndex(r=>K(r));h!==-1?s.value=s.value.filter((r,C)=>C!==h):s.value=[...s.value,l]}else b.selectionBehavior==="replace"?s.value={...l}:!Array.isArray(s.value)&&K(s.value)?s.value=void 0:s.value={...l};return s.value};function A(l,K,h,r){if(!e?.value||!b.multiple||!Array.isArray(s.value))return;const T=h().filter(S=>S.ref.dataset.disabled!=="").find(S=>S.ref===K)?.value;if(!T)return;let I=null;switch(l){case"prev":case"next":{I=W(r,e.value,T);break}case"first":{I=W(r,e.value,r?.[0]);break}case"last":{I=W(r,e.value,r?.[r.length-1]);break}}s.value=I}return{firstValue:e,onSelectItem:v,handleMultipleReplace:A}}function z(s){return s.reduce((b,e)=>(b.push(e),e.children&&b.push(...z(e.children)),b),[])}const[Ae,Ee]=ce("TreeRoot");var _e=te({__name:"TreeRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},items:{type:Array,required:!1},expanded:{type:Array,required:!1},defaultExpanded:{type:Array,required:!1},getKey:{type:Function,required:!0},getChildren:{type:Function,required:!1,default:s=>s.children},selectionBehavior:{type:String,required:!1,default:"toggle"},multiple:{type:Boolean,required:!1,skipCheck:!0},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},propagateSelect:{type:Boolean,required:!1},bubbleSelect:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"ul"}},emits:["update:modelValue","update:expanded"],setup(s,{emit:b}){const e=s,v=b,{items:A,multiple:l,disabled:K,propagateSelect:h,dir:r,bubbleSelect:C}=ue(e),{handleTypeaheadSearch:T}=oe(),I=de(r),S=L(),_=L(!1),V=fe(),d=J(e,"modelValue",v,{defaultValue:e.defaultValue??(l.value?[]:void 0),passive:!0,deep:!0}),x=J(e,"expanded",v,{defaultValue:e.defaultExpanded??[],passive:e.expanded===void 0,deep:!0}),{onSelectItem:n,handleMultipleReplace:i}=Se(d,e),t=R(()=>l.value&&Array.isArray(d.value)?d.value.map(a=>e.getKey(a)):[e.getKey(d.value??{})]);function c(a,o=1,k){return a.reduce((p,E,N)=>{const H=e.getKey(E),G=e.getChildren(E),ie=x.value.includes(H),se={_id:H,value:E,index:N,level:o,parentItem:k,hasChildren:!!G,bind:{value:E,level:o,"aria-setsize":a.length,"aria-posinset":N+1}};return p.push(se),G&&ie&&p.push(...c(G,o+1,E)),p},[])}const u=R(()=>{const a=e.items;return x.value.map(o=>o),c(a??[])});function g(a){if(_.value)V.trigger(a);else{const o=S.value?.getItems()??[];T(a.key,o)}}function f(a){if(_.value)return;const o=pe[a.key];he(()=>{i(o,U(),S.value?.getItems,u.value.map(k=>k.value))})}function y(a){if(a.parentItem!=null&&Array.isArray(d.value)&&e.multiple){const o=u.value.find(k=>a.parentItem!=null&&e.getKey(k.value)===e.getKey(a.parentItem));o!=null&&(e.getChildren(o.value)?.every(p=>d.value.find(E=>e.getKey(E)===e.getKey(p)))?d.value=[...d.value,o.value]:d.value=d.value.filter(p=>e.getKey(p)!==e.getKey(o.value)),y(o))}}return Ee({modelValue:d,selectedKeys:t,onSelect:a=>{const o=p=>e.getKey(p??{})===e.getKey(a),k=e.multiple&&Array.isArray(d.value)?d.value?.findIndex(o)!==-1:void 0;if(n(a,o),e.bubbleSelect&&e.multiple&&Array.isArray(d.value)){const p=u.value.find(E=>e.getKey(E.value)===e.getKey(a));p!=null&&y(p)}if(e.propagateSelect&&e.multiple&&Array.isArray(d.value)){const p=z(e.getChildren(a)??[]);k?d.value=[...d.value].filter(E=>!p.some(N=>e.getKey(E??{})===e.getKey(N))):d.value=[...d.value,...p]}},expanded:x,onToggle(a){if(!(a?e.getChildren(a):void 0))return;const k=e.getKey(a)??a;x.value.includes(k)?x.value=x.value.filter(p=>p!==k):x.value=[...x.value,k]},getKey:e.getKey,getChildren:e.getChildren,items:A,expandedItems:u,disabled:K,multiple:l,dir:I,propagateSelect:h,bubbleSelect:C,isVirtual:_,virtualKeydownHook:V,handleMultipleReplace:i}),(a,o)=>(w(),F(m(ve),{ref_key:"rovingFocusGroupRef",ref:S,"as-child":"",orientation:"vertical",dir:m(I)},{default:P(()=>[B(m(ae),{role:"tree",as:a.as,"as-child":a.asChild,"aria-multiselectable":m(l)?!0:void 0,onKeydown:[g,j(D(f,["shift"]),["up","down"])]},{default:P(()=>[ne(a.$slots,"default",{flattenItems:u.value,modelValue:m(d),expanded:m(x)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),qe=_e;const we="tree.select",Re="tree.toggle";var Be=te({inheritAttrs:!1,__name:"TreeItem",props:{value:{type:null,required:!0},level:{type:Number,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["select","toggle"],setup(s,{expose:b,emit:e}){const v=s,A=e,l=Ae(),{getItems:K}=me(),h=R(()=>!!l.getChildren(v.value)),r=R(()=>{const n=l.getKey(v.value);return l.expanded.value.includes(n)}),C=R(()=>{const n=l.getKey(v.value);return l.selectedKeys.value.includes(n)}),T=R(()=>{if(l.bubbleSelect.value&&h.value&&Array.isArray(l.modelValue.value)){const n=z(l.getChildren(v.value)||[]);return n.some(i=>l.modelValue.value.find(t=>l.getKey(t)===l.getKey(i)))&&!n.every(i=>l.modelValue.value.find(t=>l.getKey(t)===l.getKey(i)))}else return l.propagateSelect.value&&C.value&&h.value&&Array.isArray(l.modelValue.value)?!z(l.getChildren(v.value)||[]).every(i=>l.modelValue.value.find(t=>l.getKey(t)===l.getKey(i))):void 0});function I(n){if(h.value)if(r.value){const i=K().map(f=>f.ref),t=U(),c=i.indexOf(t),g=[...i].slice(c).find(f=>Number(f.getAttribute("data-indent"))===v.level+1);g&&g.focus()}else x(n)}function S(n){if(r.value)x(n);else{const i=K().map(f=>f.ref),t=U(),c=i.indexOf(t),g=[...i].slice(0,c).reverse().find(f=>Number(f.getAttribute("data-indent"))===v.level-1);g&&g.focus()}}async function _(n){A("select",n),!n?.defaultPrevented&&l.onSelect(v.value)}async function V(n){A("toggle",n),!n?.defaultPrevented&&l.onToggle(v.value)}async function d(n){if(!n)return;const i={originalEvent:n,value:v.value,isExpanded:r.value,isSelected:C.value};Y(we,_,i)}async function x(n){if(!n)return;const i={originalEvent:n,value:v.value,isExpanded:r.value,isSelected:C.value};Y(Re,V,i)}return b({isExpanded:r,isSelected:C,isIndeterminate:T,handleToggle:()=>l.onToggle(v.value),handleSelect:()=>l.onSelect(v.value)}),(n,i)=>(w(),F(m(Ke),{"as-child":"",value:n.value,"allow-shift-key":""},{default:P(()=>[B(m(ae),re(n.$attrs,{role:"treeitem",as:n.as,"as-child":n.asChild,"aria-selected":C.value,"aria-expanded":h.value?r.value:void 0,"aria-level":n.level,"data-indent":n.level,"data-selected":C.value?"":void 0,"data-expanded":r.value?"":void 0,onKeydown:[j(D(d,["self","prevent"]),["enter","space"]),i[0]||(i[0]=j(D(t=>m(l).dir.value==="ltr"?I(t):S(t),["prevent"]),["right"])),i[1]||(i[1]=j(D(t=>m(l).dir.value==="ltr"?S(t):I(t),["prevent"]),["left"]))],onClick:i[2]||(i[2]=D(t=>{d(t),x(t)},["stop"]))}),{default:P(()=>[ne(n.$slots,"default",{isExpanded:r.value,isSelected:C.value,isIndeterminate:T.value,handleSelect:()=>m(l).onSelect(n.value),handleToggle:()=>m(l).onToggle(n.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),Ve=Be;const Le={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},Fe=Object.assign({inheritAttrs:!1},{__name:"ProseCodeTree",props:{items:{type:Array,required:!1},modelValue:{type:String,required:!1},defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},emits:["update:modelValue"],setup(s,{emit:b}){const e=s,v=b,A=ge(),l=ye(),[K,h]=be(),r=R(()=>Z({extend:Z(Le),...l.ui?.prose?.codeTree||{}})()),C=e.modelValue??e.defaultValue,T=L(C?{path:C}:void 0),I=L();O(T,t=>{t?.path!==e.modelValue&&v("update:modelValue",t?.path)}),O(()=>e.modelValue,t=>{if(t===T.value?.path)return;T.value=t?{path:t}:void 0;const c=n(t);for(const u of c)i.value.includes(u)||i.value.push(u)});const S=L(1),_=R(()=>(S.value,e.items||A.default?.()?.flatMap(x).filter(Boolean)||[])),V=R(()=>d(_.value));function d(t){const c=new Map,u=[];t.forEach(f=>{const y=f.label.split("/");let a="";y.forEach((o,k)=>{if(a=a?`${a}/${o}`:o,!c.has(a)){const p={label:o,path:a,...k<y.length-1&&{children:[]}};c.set(a,p),k===0?u.push(p):c.get(y.slice(0,k).join("/"))?.children?.push(p)}})});const g=f=>f.sort((y,a)=>!!y.children==!!a.children?y.label.localeCompare(a.label):a.children?1:-1).map(y=>({...y,children:y.children&&g(y.children)}));return g(u)}function x(t,c){return typeof t.type=="symbol"?t.children?.map(x):{label:t.props?.filename||t.props?.label||`${c}`,icon:t.props?.icon,component:t}}function n(t){if(e.expandAll){const u=new Set;return _.value.forEach(g=>{const f=g.label.split("/");for(let y=1;y<f.length;y++)u.add(f.slice(0,y).join("/"))}),Array.from(u)}if(!t)return[];const c=t.split("/");return c.slice(0,-1).map((u,g)=>c.slice(0,g+1).join("/"))}const i=L(n(T.value?.path));return O(_,()=>{e.expandAll&&(i.value=n())},{immediate:!0}),O(T,t=>{const c=_.value.find(u=>t?.path===u.label);c?.component&&(I.value=c)},{immediate:!0}),xe(()=>S.value++),(t,c)=>(w(),$(X,null,[B(m(K),null,{default:P(({items:u,level:g})=>[(w(!0),$(X,null,ke(u,(f,y)=>(w(),$("li",{key:`${g}-${y}`,role:"presentation",class:q(g>1?r.value.itemWithChildren({class:e.ui?.itemWithChildren}):r.value.item({class:e.ui?.item}))},[B(m(Ve),{level:g,value:f,"as-child":""},{default:P(({isExpanded:a,isSelected:o})=>[M("button",{type:"button",class:q(r.value.link({class:e.ui?.link,active:o}))},[f.children?.length?(w(),F(le,{key:0,name:a?m(l).ui.icons.folderOpen:m(l).ui.icons.folder,class:q(r.value.linkLeadingIcon({class:e.ui?.linkLeadingIcon}))},null,8,["name","class"])):(w(),F(Ie,{key:1,filename:f.label,class:q(r.value.linkLeadingIcon({class:e.ui?.linkLeadingIcon}))},null,8,["filename","class"])),M("span",{class:q(r.value.linkLabel({class:e.ui?.linkLabel}))},Te(f.label),3),f.children?.length?(w(),$("span",{key:2,class:q(r.value.linkTrailing({class:e.ui?.linkTrailing}))},[B(le,{name:m(l).ui.icons.chevronDown,class:q(r.value.linkTrailingIcon({class:e.ui?.linkTrailingIcon}))},null,8,["name","class"])],2)):ee("",!0)],2),f.children?.length&&a?(w(),$("ul",{key:0,role:"group",class:q(r.value.listWithChildren({class:e.ui?.listWithChildren}))},[B(m(h),{items:f.children,level:g+1},null,8,["items","level"])],2)):ee("",!0)]),_:2},1032,["level","value"])],2))),128))]),_:1}),M("div",re(t.$attrs,{class:r.value.root({class:[e.ui?.root,e.class]})}),[B(m(qe),{modelValue:T.value,"onUpdate:modelValue":c[0]||(c[0]=u=>T.value=u),expanded:i.value,"onUpdate:expanded":c[1]||(c[1]=u=>i.value=u),class:q(r.value.list({class:e.ui?.list})),items:V.value,"get-key":u=>u.path},{default:P(()=>[B(m(h),{items:V.value,level:1},null,8,["items"])]),_:1},8,["modelValue","expanded","class","items","get-key"]),M("div",{class:q(r.value.content({class:e.ui?.content}))},[(w(),F(Ce(I.value?.component)))],2)],16)],64))}});export{Fe as default};
