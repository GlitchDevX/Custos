{
  "swagger": "2.0",
  "basePath": "/",
  "paths": {
    "/analyze/": {
      "post": {
        "responses": {
          "200": {
            "description": "Labels",
            "schema": {
              "$ref": "#/definitions/analyze_result"
            }
          },
          "500": {
            "description": "Model Missing",
            "schema": {
              "$ref": "#/definitions/analyze_unavailable"
            }
          },
          "425": {
            "description": "Loading Model",
            "schema": {
              "$ref": "#/definitions/analyze_loading"
            }
          },
          "503": {
            "description": "Endpoint Disabled",
            "schema": {
              "$ref": "#/definitions/endpoint_disabled"
            }
          }
        },
        "summary": "/analyze",
        "description": "Returns a list of labels detected by the detoxify multilingual model.\n\nAvailable labels are:\n`toxicity`, `severe_toxicity`, `obscene`, `threat`, `insult`, `identity_attack`, `sexual_explicit`",
        "operationId": "post_analyze_resource",
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "content": {
                  "type": "string"
                }
              }
            }
          }
        ],
        "tags": [
          "Analyze"
        ]
      }
    },
    "/config/": {
      "put": {
        "responses": {
          "200": {
            "description": "Update Success",
            "schema": {
              "$ref": "#/definitions/config_update_successful"
            }
          },
          "404": {
            "description": "Namespace not Found",
            "schema": {
              "$ref": "#/definitions/namespace_not_found"
            }
          },
          "503": {
            "description": "Endpoint Disabled",
            "schema": {
              "$ref": "#/definitions/endpoint_disabled"
            }
          }
        },
        "summary": "/config",
        "description": "Update the configuration for the specified namespace.",
        "operationId": "put_config_resource",
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "namespace": {
                  "type": "string"
                },
                "content": {
                  "type": "string"
                }
              }
            }
          }
        ],
        "tags": [
          "Config"
        ]
      },
      "get": {
        "responses": {
          "200": {
            "description": "Config Content",
            "schema": {
              "$ref": "#/definitions/config_retrieve_successful"
            }
          },
          "404": {
            "description": "Namespace not Found",
            "schema": {
              "$ref": "#/definitions/namespace_not_found"
            }
          },
          "503": {
            "description": "Endpoint Disabled",
            "schema": {
              "$ref": "#/definitions/endpoint_disabled"
            }
          }
        },
        "summary": "/config",
        "description": "Retrieve the configuration for the specified namespace.",
        "operationId": "get_config_resource",
        "parameters": [
          {
            "name": "namespace",
            "in": "query",
            "type": "string",
            "required": true
          }
        ],
        "tags": [
          "Config"
        ]
      }
    },
    "/content/": {
      "post": {
        "responses": {
          "200": {
            "description": "Content Check Result",
            "schema": {
              "$ref": "#/definitions/content_result"
            }
          },
          "503": {
            "description": "Endpoint Disabled",
            "schema": {
              "$ref": "#/definitions/endpoint_disabled"
            }
          }
        },
        "summary": "/content",
        "description": "Returns detected flags and a censored version of the given content.\n\nChecks executed:\n- `contains_url`: If the content includes a URL\n- `blocked_word`: If the content includes a blocked word\n\nThe censored version of the content will have all detected characters replaced with an asterisk `*`.",
        "operationId": "post_content_check_resource",
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "content": {
                  "type": "string"
                }
              }
            }
          }
        ],
        "tags": [
          "Content"
        ]
      }
    },
    "/mail/": {
      "post": {
        "responses": {
          "200": {
            "description": "Mail Validation Result",
            "schema": {
              "$ref": "#/definitions/mail_result"
            }
          },
          "503": {
            "description": "Endpoint Disabled",
            "schema": {
              "$ref": "#/definitions/endpoint_disabled"
            }
          }
        },
        "summary": "/mail",
        "description": "Returns a code and user-friendly text for the given email address.\n\nThe code depends on the check the email failed at.\n\nPossible codes:\n- `OK`: All checks passed\n- `FORMAT_INVALID`: Invalid email format\n- `DISPOSABLE`: Domain of the email was marked disposable\n- `NO_SERVER`: The domain of the email does not have a mail server\n- `NO_ADDRESS`: The mail server does not have the given email address\n- `INVALID_DOMAIN`: Could not resolve dns records of domain\n- `SMTP_DISCONNECT`: The smtp server disconnected while checking email\n- `SMTP_CONNECTION_ERROR`: A smpt error occurred while checking email\n- `SMTP_TIMEOUT`: The smtp server timed out while checking email",
        "operationId": "post_mail_validation_resource",
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "mail": {
                  "type": "string"
                }
              }
            }
          }
        ],
        "tags": [
          "Mail"
        ]
      }
    },
    "/metrics/": {
      "get": {
        "responses": {
          "503": {
            "description": "Endpoint Disabled",
            "schema": {
              "$ref": "#/definitions/endpoint_disabled"
            }
          },
          "200": {
            "description": "Prometheus Metrics",
            "schema": {
              "type": "string"
            }
          }
        },
        "summary": "/metrics",
        "description": "Returns service usage metrics as well as some generic Flask metrics in the Prometheus format.",
        "operationId": "get_metrics_resource",
        "tags": [
          "Metrics"
        ]
      }
    }
  },
  "info": {
    "title": "Custos",
    "version": "1.0.0",
    "description": "Modular user-content management system written in Python.\n\nAll endpoints in this documentation will be displayed with a trailing slash, but they will also work without it."
  },
  "produces": [
    "application/json"
  ],
  "consumes": [
    "application/json"
  ],
  "tags": [
    {
      "name": "Metrics",
      "description": "Endpoint for getting metrics for Prometheus."
    },
    {
      "name": "Mail",
      "description": "Endpoint for validating emails."
    },
    {
      "name": "Config",
      "description": "\nEndpoints to modify and retrieve configuration.\n\nAll settings are split into namespaces reflecting the individual endpoints.\n\nAvailable namespaces:\n- `content_check`\n- `deep_analysis`\n- `mail_validation`\n- `metrics`\n"
    },
    {
      "name": "Content",
      "description": "Endpoint for checking content against certain criteria."
    },
    {
      "name": "Analyze",
      "description": "Endpoint for deep content analysis."
    }
  ],
  "definitions": {
    "endpoint_disabled": {
      "properties": {
        "error": {
          "type": "string",
          "default": "ENDPOINT_DISABLED"
        },
        "text": {
          "type": "string",
          "default": "This endpoint is disabled. You can enable it in the config."
        }
      },
      "type": "object"
    },
    "mail_result": {
      "properties": {
        "code": {
          "type": "string"
        },
        "text": {
          "type": "string"
        }
      },
      "type": "object"
    },
    "config_update_successful": {
      "properties": {
        "CODE": {
          "type": "string",
          "default": "OK"
        }
      },
      "type": "object"
    },
    "namespace_not_found": {
      "properties": {
        "error": {
          "type": "string",
          "default": "NAMESPACE_NOT_FOUND"
        },
        "text": {
          "type": "string",
          "default": "Config Namespace not found"
        }
      },
      "type": "object"
    },
    "config_retrieve_successful": {
      "properties": {
        "property_name*": {
          "type": "string",
          "default": "Any"
        }
      },
      "type": "object"
    },
    "content_result": {
      "properties": {
        "flags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "censored_content": {
          "type": "string"
        }
      },
      "type": "object"
    },
    "analyze_result": {
      "properties": {
        "labels": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "type": "object"
    },
    "analyze_unavailable": {
      "properties": {
        "code": {
          "type": "string",
          "default": "MODEL_UNAVAILABLE"
        },
        "text": {
          "type": "string",
          "default": "The detoxify model is missing."
        }
      },
      "type": "object"
    },
    "analyze_loading": {
      "properties": {
        "code": {
          "type": "string",
          "default": "MODEL_TEMPORARY_UNAVAILABLE"
        },
        "text": {
          "type": "string",
          "default": "The detoxify model is still loading, please try again in a minute."
        }
      },
      "type": "object"
    }
  },
  "responses": {
    "ParseError": {
      "description": "When a mask can't be parsed"
    },
    "MaskError": {
      "description": "When any error occurs on mask"
    }
  }
}
